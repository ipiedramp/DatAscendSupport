name: Notify Google Chat on Issue Events

on:
  issues:
    types: [opened, edited, closed]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send message to Google Chat
        run: |
          EVENT="${{ github.event.action }}"
          TITLE="${{ github.event.issue.title }}"
          AUTHOR="${{ github.actor }}"
          URL="${{ github.event.issue.html_url }}"
          REPO="${{ github.repository }}"

          if [ "$EVENT" = "opened" ]; then
            MSG="✅ New Issue created in *$REPO*%0A👉 Title: $TITLE%0A✍️ Author: $AUTHOR%0A🔗 Link: $URL"
          elif [ "$EVENT" = "edited" ]; then
            MSG="🔄 Issue updated in *$REPO*%0A👉 Title: $TITLE%0A✍️ Author: $AUTHOR%0A🔗 Link: $URL"
          elif [ "$EVENT" = "closed" ]; then
            MSG="🛑 Issue closed in *$REPO*%0A👉 Title: $TITLE%0A✍️ Closed by: $AUTHOR%0A🔗 Link: $URL"
          else
            MSG="ℹ️ Issue event ($EVENT) in *$REPO*%0A👉 Title: $TITLE%0A✍️ Author: $AUTHOR%0A🔗 Link: $URL"
          fi

          curl -X POST \
            -H 'Content-Type: application/json' \
            -d "{\"text\": \"$MSG\"}" \
            "${{ secrets.GOOGLE_CHAT_WEBHOOK }}"
